\documentclass{sig-alternate}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{mysymbols}
\usepackage{hyperref}
\usepackage{tikz}
\usepackage{dblfloatfix}
\usepackage{placeins}

\newtheorem{definition}{Definition}
\newtheorem{theorem}[definition]{Theorem}
\newtheorem{lemma}[definition]{Lemma}
\newtheorem{corollary}[definition]{Corollary}
\newtheorem{proposition}[definition]{Proposition}

\usepackage{algorithm}
\usepackage{algorithmic}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}

\usepackage{xcolor}
\newcommand{\todo}[1]{\textcolor{red}{(#1)}}

\newcommand{\Cyc}{\Phi}  % Cyclotomic polynomial
\newcommand{\bb}{\mathbf{B}}  
\newcommand{\uu}{\mathbf{U}}  % bases for lift and push

\newdef{remark}{Remark}

\begin{document}

\title{Cool title to catch Lenstra's eye goes here}
\numberofauthors{3}
\author{
  \alignauthor Luca De Feo
  \alignauthor Javad Doliskani
  \alignauthor \'Eric Schost
}

\maketitle
\begin{abstract}
  We build towers.
\end{abstract}
\category{F.2.1}{Theory of computation}{Analysis of algorithms and problem complexity}[Computations in finite fields]
\category{G.4}{Mathematics of computing}{Mathematical software}
\terms{Algorithms,Theory}
\keywords{Finite fields, irreducible polynomials, extension towers, algebraic tori, elliptic curves.}

%%%

\section{Introduction}
\label{sec:intro}

Building arbitrary finite extensions of finite fields is a fundamental
task in any computer algebra system. Many systems are limited to
construct extensions of prime fields, but there is one notable
exception: Magma~\cite{MAGMA} has implemented for a long time a
powerful system of ``compatibly embedded finite
fields''~\cite{bosma+cannon+steel97}, capable of building extensions
of any finite field and keeping track of the embeddings between the
fields.

The system implemented in Magma, as described in the original paper,
uses linear algebra to describe the embeddings of finite fields. From
a complexity point of view, this is far from optimal: one may hope to
compute and apply the morphisms in quasi-linear time in the degree of
the extension, but this is usually out of reach of plain linear
algebra techniques. Even worse, the quadratic memory requirements make
the system unsuitable for embeddings of large degree
extensions. Although the Magma core has evolved since the publication
of the paper, experiments in Section~\ref{sec:impl} show that
embeddings of large extension fields are still out of reach.

In this paper, we discuss an approach based on polynomial arithmetic
rather than linear algebra, yielding much better performances. We only
consider some special cases, but we expect that these results will
pave the way towards a complete solution.

%%%% it feels stupid to put the table here, but I want it on page 2.
%%%% if I were better at floats, I would know how to put it where it belongs
\begin{table*}[!t]
$$
\begin{array}{c|cccc}
  \text{Condition} & \text{Initialization} & Q_i, T_i & \text{Lift, push}\\
  \hline \hline
  q = 1 \bmod \ell & O_e(\Mult(\ell) + \log(q))  & O(\ell^i) & O(\ell^i) \\
  q = -1 \bmod \ell & O_e(\Mult(\ell) \log(\ell q)\log(q)) & O(\ell^i) & O(\Mult(\ell^i) \log(\ell^i)) \\
  - & O_e (\ell^2+\Mult(\ell) \log(q)) & O(i^2\Mult(\ell^{i+1})\Mult(\ell)\log(\ell)^2) & O(i \Mult(\ell^{i+1})\Mult(\ell)\log(\ell))
\end{array}
$$
\label{table:main}
\caption{Summary of results}
\end{table*}

Let $q$ be a power of a prime $p$, let $\F_q$ be the finite field with
$q$ elements and let $\ell$ be a new integer. Our main interest in
this paper is on the algorithmic aspects of the \emph{$\ell$-adic
  closure} of $\F_q$, which is defined as follows. Fix arbitrary
embeddings
\begin{equation*}
  \F_q \subset \F_{q^\ell} \subset \F_{q^{\ell^2}} \subset \cdots;
\end{equation*}
then, the $\ell$-adic closure of $\F_q$ is the infinite field defined as
\begin{equation*}
  \F_q^{(\ell)} = \bigcup_{i\ge 0}\F_{q^{\ell^i}}.
\end{equation*}
We also call an \emph{$\ell$-adic tower} the sequence of extensions
$\F_q,\F_{q^\ell},\dots$ An important feature of $\ell$-adic towers is
that they allow us to build the algebraic closure $\bar{\F}_q$ of
$\F_q$, as there is an isomorphism
\begin{equation}
  \label{eq:tensor}
  \bar{\F}_q \isom \bigotimes_{\ell\text{ prime}} \F_q^{(\ell)},
\end{equation}
where the tensor products are over $\F_q$; we will briefly mention
below the algorithmic counterpart of this equality.

Our contribution is algorithms that allow us to ``compute'' in the
first levels of $\ell$-adic towers (in a sense defined hereafter); at
level $i$, our goal is to be able to perform all basic operations in
quasi-linear time in the extension degree $\ell^i$.  We do not discuss
the representation of the base field $\F_q$ itself, and we count
arithmetic operations $\{+,-,\times,\div\}$ in $\F_q$ at unit cost.

%% Since our focus is on the representation of extensions of large
%% degree, we do not consider issues related to special representations
%% of small finite fields, such as primitive polynomials, Zech
%% logarithms, Conway polynomials, etc.

The techniques we use are inspired by those in~\cite{df+schost12},
which dealt with the Artin-Schreier case $\ell=p$ (see
also~\cite{DoSc12}, which reused these ideas in the case $\ell=2$): we
construct families of irreducible polynomials with special properties,
then give algorithms that exploit the special form of those
polynomials to apply the embeddings. Because they are treated in the
references~\cite{df+schost12,DoSc12}, {\em we exclude the cases $\ell=p$
and $\ell=2$}.

The field $\F_{q^{\ell^i}}$ will be represented as a univariate
quotient ring $\F_q[X_i]/\langle Q_i\rangle$, for some irreducible
polynomial $Q_i \in \F_q[X_i]$. Letting $x_i$ be the residue class of
$X_i$ modulo $Q_i$, $\F_{q^{\ell^i}}$ is endowed with the monomial
basis
\begin{equation}
  \label{eq:uni-basis1}
  \uu_i = (1,x_{i},x_{i}^2,\ldots,x_{i}^{\ell^{i}-1}).
\end{equation}
Using this representation allows us to use asymptotically fast
algorithms for basic arithmetic operations. Let indeed $\Mult : \N
\rightarrow \N$ be such that polynomials in $\F_q[X]$ of degree less
than $n$ can be multiplied in $\Mult(n)$ operations in $\F_q$, under
the assumptions of~\cite[Ch.~8.3]{vzGG}; using FFT multiplication, one
can take $\Mult(n)=O(n\log (n) \log\log (n))$. Then, multiplications
and inversions in $\F_q[X_i]/\langle Q_i \rangle$ can be done in
respectively $O(\Mult(\ell^i))$ and $O(\Mult(\ell^i)\log(\ell^i))$
operations in $\F_q$~\cite[Ch.~9-11]{vzGG}. This is almost optimal, as
both results are quasi-linear in $[\F_{q^{\ell^i}}:\F_q]=\ell^i$.

Computing embeddings requires more work. For this problem, it is
enough consider a pair of consecutive levels in the tower; any other
embedding is done by applying repeatedly this elementary
operation. Following again~\cite{df+schost12}, we introduce two
slightly more general operations, {\em lift} and {\em push}.

To motivate them, remark that for $i \ge 2$, $\F_{q^{\ell^{i}}}$ has
two natural bases as a vector space over $\F_q$. The first one is via
the monomial basis $\uu_{i}$ seen above, corresponding to the
univariate model $\F_q[X_{i}]/ \langle Q_{i} \rangle$. The second one
amounts to seeing $\F_{q^{\ell^{i}}}$ as a degree $\ell$ extension of
$\F_{q^{\ell^{i-1}}}$, that is, as
\begin{equation}\label{eq:QiTi}
\F_q[X_{i-1},X_i]/\langle Q_{i-1}(X_{i-1}), T_i(X_{i-1},X_i)\rangle,  
\end{equation}
for some polynomial $T_i$ monic of degree $\ell$ in $X_{i}$, and of
degree less than $\ell^{i-1}$ in $X_{i-1}$.  The corresponding basis is
bivariate and involves $x_{i-1}$ and $x_i$:
\begin{equation}
  \label{eq:bi-basis}
  \bb_{i} = (1,\ldots,x_{i-1}^{\ell^{i-1}-1},\ldots,x_i^{\ell-1},\ldots,x_{i-1}^{\ell^{i-1}-1}x_i^{\ell-1}).
\end{equation}
{\em Lifting} corresponds to the change of basis from $\bb_i$ to
$\uu_i$; {\em pushing} is the inverse transformation.

Lift and push allow us to perform embeddings as a particular case, but
they are also the key to many further operations. We do not give
details here, but we refer the reader
to~\cite{df+schost12,DoSc12,LeSc12} for examples such as the
computation of relative traces, norms or characteristic polynomials,
and applications to solving Artin-Schreier or quadratic equations,
given in~\cite{df+schost12} and~\cite{DoSc12} for respectively
$\ell=p$ and $\ell=2$.

Table~\ref{table:main} summarizes the main results in this paper.
Under different kinds of assumptions, it gives costs for initializing
the construction, building the polynomials $Q_i$ and $T_i$
from~Eq.\eqref{eq:QiTi}, and performing lift and push; the notation
$O_e(\ )$ indicates probabilistic algorithms with expected running
time. In all cases, we obtain algorithms that are close to being
linear-time in $\ell^i$, up to sometimes the loss of a factor
polynomial in $\ell$. Except for the (very simple) case where $q=1 \bmod
\ell$, these results are new, to the best of our knowledge.

These results are obtained from two different constructions: the first
one (Section~\ref{sec:LDtower}) uses Kummer theory and descent
algorithms; the second one (Section~\ref{sec:fibers}) relies on the
construction of a sequence of fibers of isogenies between elliptic
curves. Both constructions are inspired by previous results due to
respectively Shoup~\cite{Shoup90,shoup94} and Lenstra-De
Smit~\cite{lenstra+desmit08-stdmodels}, and
Couveignes-Lercier~\cite{couveignes+lercier11}; we briefly discuss
them here and give more details in the further sections.

Lenstra and De Smit~\cite{lenstra+desmit08-stdmodels} address
questions similar to ours, the construction of the $\ell$-adic closure
of $\F_q$, and then of its algebraic closure, but with a different
purpose (standardizing the construction). The resulting algorithms run
in polynomial time, but (implicitly) rely on linear algebra techniques
and the use of multiplication tables, so quasi-linear time is not
directly reachable.
References~\cite{Shoup90,shoup94,couveignes+lercier11} discuss a
related problem, the construction of irreducible polynomials of
prescribed degree over $\F_q$; the question of applying embeddings
between the levels of the tower is not present there.

To conclude the introduction, let us mention a few applications of our
results. 

A variety of computations in number theory and algebraic geometry
require constructing new extension fields and moving elements from one
to the other. As it turns out, in many cases, the $\ell$-adic
constructions considered here are sufficient: two examples of such
problems are~\cite{df10,GaSc12}, both in relation to torsion subgroups
of Jacobians of curves. Our construction makes such computations
feasible for much larger sizes than was previously possible.

The main question remains of course the cost of computing in arbitrary
extensions. As showed by Eq.~\eqref{eq:tensor}, this boils down to the
study of $\ell$-adic towers, as done in this paper, together with
algorithms for computing in \emph{composita}.
References~\cite{Shoup90,shoup94,couveignes+lercier11} deal with
related questions for the problem of computing irreducible polynomials;
a natural follow-up to the present work is to study the cost of
embeddings and similar change of bases in this more general context.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{XXX's towers}
\label{sec:LDtower}

In this section, we discuss a construction of the $\ell$-adic tower
over $\F_q$ inspired by previous work of Shoup~\cite{Shoup90,shoup94},
Lenstra-De Smit~\cite{lenstra+desmit08-stdmodels} and
Couveignes-Lercier~\cite{couveignes+lercier11}. The results of this
section establish the first three rows of Table~\ref{table:main}, up
to one exception.

We start by constructing an extension $\K_0 = \F_q[Y_0]/\langle P_0
\rangle$, such that the residue class $y_0$ of $Y_0$ is a non
$\ell$-adic residue in $\K_0$ (we discuss this in more detail in the
first subsection), and we let $r$ be the degree of $P_0$.

By~\cite[Th.~VI.9.1]{lang}, for $i\ge 1$, the polynomial
$Y_i^{\ell^i}-y_0$ is irreducible in $\K_0[Y_i]$, so that $\K_i=
\K_0[Y_i]/\langle Y_i^{\ell^i}-y_0\rangle$ is a field with $q^{r
  \ell^i}$ elements.  If we let $y_i$ be the residue class of $Y_i$ in
$\K_i$, these fields are naturally embedded in one another by the
isomorphism $\K_{i+1} \simeq \K_i[Y_{i+1}]/\langle
Y_{i+1}^\ell-y_i\rangle$; in particular, the relation
$y_{i+1}^\ell=y_i$ holds.

In order to build $\F_{q^{\ell^i}}$, we apply a descent process, for
which we follow an idea of Shoup's. For $i \ge 0$, let $x_i$ be the
trace of $y_i$ over a subfield of index $r$:
\begin{equation}\label{eq-def:xi}
x_i = \sum_{j = 0}^{r-1} y_i^{q^{\ell^i j}}.  
\end{equation}
Then,~\cite[Th.~2.1]{Shoup90} proves that $\F_q(x_i)=\F_{q^{\ell^i}}$;
in other words, we arrive at the situation depicted in
Figure~\ref{fig:ladic}. In particular, the minimal polynomials of
$x_1,x_2,\dots$ form the family of irreducible polynomials $Q_i$ we
are interested in.

\begin{figure}[h]
  \centering
  \begin{tikzpicture}[node distance=1.6cm]
    \node(Q){$\F_q$};
    \node(Q0)[above left of=Q]{$\K_0=\F_q(y_0)$};
    \node(K1)[above right of=Q]{$\F_{q^\ell}=\F_q(x_1)$};
    \node(Q1)[above right of=Q0]{$\K_1=\K_0(y_1)$};
    \node(K2)[above right of=K1]{$\F_{q^{\ell^2}}=\F_q(x_2)$};
    \node(Q2)[above right of=Q1]{$\K_2=\K_1(y_2)$};
    \node(Koo)[above right of=K2]{$\quad \F_q^{(\ell)}$};
    \node(Qoo)[above right of=Q2]{$\quad\K_0^{(\ell)}$};
    \draw (Q) edge node[auto]{\scriptsize$r$} (Q0)
              edge node[auto,swap]{\scriptsize$\ell$} (K1)
          (K1) edge node[auto]{\scriptsize$r$} (Q1)
               edge node[auto,swap]{\scriptsize$\ell$} (K2)
          (Q1) edge node[auto]{\scriptsize$\ell$} (Q0)
          (Q2) edge node[auto,swap]{\scriptsize$r$} (K2)
               edge node[auto]{\scriptsize$\ell$} (Q1)
               edge[dashed] (Qoo)
          (Koo) edge[dashed] (K2)
               edge node[auto]{\scriptsize$r$} (Qoo);
  \end{tikzpicture}
  \caption{The $\ell$-adic towers over $\F_q$ and $\K_0$.}
  \label{fig:ladic}
\end{figure}

We will show how to compute the polynomials $Q_i$, the polynomials
$T_i$ introduced in Eq.~\eqref{eq:QiTi} and how to perform lift and
push.  To this effect, we will define more general minimal
polynomials: for $0 \le j \le i$, we will let $Q_{i,j} \in
\F_q(x_j)[X_j]$ be the minimal polynomial of $x_i$ over $\F_q(x_j)$,
so that $Q_{i,j}$ has degree $\ell^{i-j}$, with in particular
$Q_{i,0}=Q_i$ and $Q_{i,i-1}=T_i(x_{i-1},X_i)$.

We first consider two favorable cases, where $\ell$ divides
respectively $q-1$ and $q+1$, before discussing the general case.

The first case is folklore; it yields the fastest and simplest
algorithms. Our results for the second case are close to, but distinct
from, previous work of Gurak~\cite{gurak06}; the algorithms are
slightly slower than in the first case. Our results in the general
case are yet slower, but they are still quasi-linear in $\ell^i$, up
to the loss of a factor polynomial in $\ell$. 

To our knowledge, the construction we use first appears
in~\cite{Shoup90,shoup94}, which show how to compute $Q_i$ in time
quadratic in $\ell^i$~\cite[Th.~11]{shoup94}.  Using {\em modular
  composition} techniques~\cite[Ch.~12]{vzGG}, this quadratic behavior
could be improved to get an exponent in $[1.5, 2]$, up to an extra
cost polynomial in $\ell$.  Remark that for $\ell=3$ (where we are in
one the first two cases), Couveignes and Lercier mention such an idea
in~\cite[\S~2.4]{couveignes+lercier11}: using a previous result by
Kedlaya and Umans~\cite{KeUm11} for modular composition {\em in a
  boolean model} (where we count bit operations), they derive a cost
of the form $O(3^{i(1+\varepsilon)} \log(q))$ bit operations for any
$\varepsilon > 0$.

In this section, and in the rest of this paper, if $L/K$ is a field
extension, we write $\Tr_{L/K}$, $\Norm_{L/K}$ and $\Gal_{L/K}$ for
the trace, norm and Galois group of the extension. Recall also that
the notation $O_e(\ )$ indicates an {\em expected} running time.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Finding $P_0$}

To determine $P_0$, two constructions will be used. In both cases, we
start from the $\ell$-th cyclotomic polynomial $\Cyc_\ell \in
\Z[X_0]$. The first step consists in factoring $\Cyc_\ell$ over
$\F_q[X_0]$: by~\cite[Th.~9]{shoup94}, this takes
$O_e(\Mult(\ell)\log(\ell q))$ operations in $\F_q$.

Over $\F_q[X_0]$, $\Cyc_\ell$ splits into irreducible factors of the
same degree $r$, where $r$ is the order of $q$ in $\Z/\ell\Z$ (so $r$
divides $\ell-1$); let $F_0$ be one of these factors. By construction,
there exist non $\ell$-adic residues in $\F_q[X_0]/\langle F_0
\rangle$. Once such a non-residue $\eta$ is found, we simply let $P_0$
be its minimal polynomial over $\F_q$ (which still has degree $r$);
given $\eta$, computing $P_0$ takes $O(r^2)$ operations in $\F_q$.

To find $\eta$, the approach in~\cite{Shoup90,
  shoup94,couveignes+lercier11} consists in picking it at random: we
expect to find a non-residue after $O(1)$ trials;
by~\cite[Lemma~15]{shoup94}, each takes
$O_e(\Mult(\ell)\log(r)+\Mult(r)\log(\ell)\log(r)+\Mult(r)\log(q))$
operations in $\F_q$.

An alternative idea, due to Lenstra and De Smit, is to take iterated
$\ell$-th roots of $X_0 \bmod F_0$ until we find a non-residue.  Non
$\ell$-adic residues have order a multiple of $\ell^\kappa$, where
$\kappa$ is the $\ell$-adic valuation of $(q^r-1)$. Because $X_0 \bmod
F_0$ has order $\ell$, we take $\kappa-1$ successive $\ell$-th roots
modulo $F_0$ until hitting a non-residue $\eta$. Using a root-finding
algorithm for the polynomial $Y^\ell-\eta$, each root extraction takes
$O_e(\Mult(\ell)\log(\ell q))$ operations modulo
$F_0$~\cite[Ch~14]{vzGG}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{$T_1$-type extensions}\label{ssec:T1}

In this subsection, we consider the simplest case, where $\ell$
divides $q-1$; the (classical) facts below give the first row of
Table~\ref{table:main}.

In this case, $\Phi_\ell$ splits into linear factors over $\F_q$ (that
is, $r=1$). The polynomial $P_0$ is of the form $Y_0-\eta$, where
$\eta$ is a non $\ell$-adic residue in $\F_q$. In this case, we simply
find $\eta$ by random trial in $\F_q$, as no gain is to be found from
the more specific choice used by Lenstra-De Smit. Since we can bypass
the factorization of $\Phi_\ell$, the cost of initialization is
$O_e(\Mult(\ell)+\log(q))$ operations in $\F_q$.

Then, no descent is required. For $i \ge 0$, we have
$\K_i=\F_{q^{\ell^i}}$ and $x_i=y_i$; the families of polynomials we
obtain are
\begin{equation}
  \label{eq:T1}
  Q_i=X_i^{\ell^i}-\eta \quad\text{and}\quad T_i=X_{i}^\ell-X_{i-1}.
\end{equation}
Lifting amounts to taking $F = \sum_{0 \le j < \ell^{i+1}} f_j
x_{i+1}^j$ and rewriting it as a bivariate polynomial in
$x_i,x_{i+1}$, using the rule
$$x_{i+1}^j = x_i^{\,j {\rm~div~} \ell} x_{i+1}^{\,j \bmod \ell}.$$
Pushing does the converse operation, using the rule
$$x_i^e x_{i+1}^f = x_{i+1}^{e \ell + f}.$$ Both 
use only exponent arithmetic, and no operation in~$\F_q$. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{$T_2$-type extensions}
\label{ssec:T2}

Next, we consider the case where $\ell$ divides $q+1$, so that
$\Phi_\ell$ splits into quadratic factors over $\F_q$ (that is,
$r=2$). In this case, we use Lenstra and De Smit's construction of
$P_0$; since $r=2$, and using the bound $\kappa=O(\log(q))$ given in
the proof of the following lemma, we deduce that the initialization
takes $O_e(\Mult(\ell)\log(\ell q)\log(q))$ operations in $\F_q$.

\begin{lemma}
  \label{th:T2-norm}
  For $i \ge 0$, $x_i = y_i +y_i^{-1}$.
\end{lemma}
\begin{proof}
  By definition, $x_i=y_i+y_i^{q^{\ell^i}}$. Note that in the Lenstra-De
  Smit construction, $y_0$ has order $\ell^{\kappa}$, where $\kappa$
  is the $\ell$-adic valuation of $q^r-1$. Thus, $y_i$ has order
  $\ell^{i+\kappa}$, so to conclude, it is enough to prove that
  $\ell^{i+\kappa}$ divides $q^{\ell^i}+1$.

  Because $\ell$ divides $q+1$, $q+1$ and $q^{2n}-1$ have the same
  $\ell$-adic valuation for all positive integers $n$ not divisible by
  $\ell$. In particular, $\kappa$ is the $\ell$-adic valuation of
  $q+1$, so that $\ell^\kappa$ divides $q+1$, and an induction on $i$
  finishes the proof.
\end{proof}

From this, we will show how to compute the polynomials $Q_{i,j}$, and
in particular $Q_{i,0}=Q_i$ and $Q_{i,i-1}=T_i(x_{i-1},X_i)$; we leave
the algorithms for lift and push to Section~\ref{sec:lift-push}.


\begin{corollary}
  \label{th:T2-resultant}
  For $1 \le j < i$, $Q_{i,j} \in \F_q(x_{j})[X_i]$ satisfies
  \begin{equation*}
    \label{eq:T2-relpols}
    Q_{i,j}(X_i)^2 = \mathrm{Res}_{Y_i}(Y_i^{2\ell^{i-j}}-x_{j}Y_i^{\ell^{i-j}}+1,\; Y_i^2-X_i Y_i+1).
  \end{equation*}
\end{corollary}
\begin{proof}
  The previous lemma shows that the minimal polynomial of $y_i$ over
  $\F_q(x_i)$ is $Y_i^2 -x_i Y_i +1$. By composition, it follows that
  the minimal polynomial of $y_i$ over $\F_q(x_{j})$ is
  $Y_i^{2\ell^{i-j}}-x_{j} Y_i^{\ell^{i-j}}+1$. Eliminating $Y_i$ between
  these two polynomials will give the required relation between
  $x_{j}$ and $x_i$. Explicitly, the resultant above 
  is equal to
\begin{align*}
   \prod_{\sigma\in\Gal_{\K_i/\F_q(x_{j})}}
  (y_i^2 - X_i y_i + 1)^\sigma \\
  % 
  =\Norm_{\K_i/\F_q(x_{j})}(y_i) \prod_{\sigma\in\Gal_{\K_i/\F_q(x_{j})}} 
  (y_i + y_i^{-1} - X_i)^\sigma \\
  % 
  =\left(\prod_{\sigma\in\Gal_{\K_i/\F_q(x_{j})}/\langle\tau\rangle}
    (x_i - X_i)^\sigma\right)^2 \\
  % 
  =\left(\prod_{\sigma\in\Gal_{\F_q(x_i)/\F_q(x_{j})}}
    (x_i - X_i)^\sigma\right)^2 =Q_{i,j}(X_i)^2,
\end{align*}
where the third equality is true because
$\Norm_{\K_i/\F_q(x_{j})}(y_i)=1$, as seen from the minimal polynomial of
$y_i$, and where $\tau$ is the element of
$\Gal_{\K_i/\F_q(x_{j})}$ such that $\tau:y_i\mapsto y_i^{-1}$.
\end{proof}

Thus, given a field $\K$, $z \in \K$ and $n \in \N$, we just need to
show how to compute
\begin{equation*}
  Q(X) = \sqrt{\mathrm{Res}_Y(Y^{2 n}-z Y^n+1, Y^2-XY+1)}.
\end{equation*}
Let $\zeta$ and $\zeta^{-1}$ be the two roots of $Y^2-XY+1$ over an
algebraic closure of $\K(X)$. By a direct calculation, we find
\begin{equation}
  \label{eq:T2-minpols}
  Q(X) = \zeta^n + \zeta^{-n} - z.
\end{equation}
As a result, $Q$ can be computed in $O(\Mult(n))$ operations in $\K$,
using repeated squaring modulo $Y^2-XY+1$. In particular, taking
$n=\ell^i$ and returning to our initial problem, $Q_i$ can be computed
in time $O(\Mult(\ell^i))$. 

We now present a better solution. For $n \in \N$, the term
$P_{n}=\zeta^{n} + \zeta^{-n}$ is the $n$-th power sum of $Y^2-XY+1$,
thus, using Newton's identities,
\begin{equation}
  \label{eq:simple}
  \begin{aligned}
    P_0 &= 2,\\
    P_1 &= X,\\
    P_{n+1} &= X P_{n} - P_{n-1}.
  \end{aligned}
\end{equation}
Writing $P_n = \sum_i c_{n,i}X^{n-i}$, we deduce the relation
\begin{equation}
  c_{n,i} = c_{n-1,i} - c_{n-2,i-2}.
\end{equation}
%% We arrange these coefficients like in Pascal's triangle:
%% \begin{equation}
%%   \begin{tabular}{*{8}{c@{}}}
%%     &&&2\\
%%     &&1&&0\\
%%     &1&&0&&-2\\
%%     1&&0&&-3&&0
%%   \end{tabular}
%% \end{equation}
%% It is then evident that every second column is identically zero, and
%% that signs alternate in odd columns. 
Removing the odd values of $i$ and taking absolute values, the new
coefficients $b_{n,k}=\lvert c_{n+k,2k}\rvert$ satisfy the relation
\begin{equation*}
  b_{n,k} = b_{n-1,k} + b_{n-1,k-1},
\end{equation*}
which is the same as Pascal's relation. Indeed, we obtain the
$(1,2)$-Pascal triangle, also called Lucas'
triangle~\cite{benjamin10}:
%% \begin{equation*}
%%   \begin{tabular}{*{8}{c@{}}}
%%     &&&2\\
%%     &&1&&2\\
%%     &1&&3&&2\\
%%     1&&4&&5&&2
%%   \end{tabular}
%% \end{equation*}
a special case of this fact was proven by Gauss, and the general proof
is in~\cite[Prop.~1]{gurak06}. As is well-known, the coefficients of
Lucas' triangle are related to those of Pascal's by
\begin{equation}
  \label{eq:lucas-tri}
  b_{n,k} = \binom{n}{k} + \binom{n-1}{k-1} = \frac{n+k}{n}\binom{n}{k}.
\end{equation}
By using Eq.~\eqref{eq:lucas-tri} and the sign alternation property,
we obtain 
\begin{gather}
  c_{n,2k} = (-1)^kb_{n-k,k} = (-1)^k\frac{n}{n-k}\binom{n-k}{k},\\
  \label{eq:lucas-recurrence}
  \frac{c_{n,2k+2}}{c_{n,2k}} = 
  -\frac{(n-2k)(n-2k-1)}{(n-k-1)(k+1)}.
\end{gather}
This gives a formula to compute all the coefficients of $Q_{i}$ using
$O(\ell^{i})$ operations in $\F_p$, and similarly for $T_i$ (since we know
the results are the image mod $p$ of integers, we compute 
the $c_{n,2k}$ using multiplications and divisions in $\Q_p$ with
relative precision 1).

%% Eq.~\eqref{eq:lucas-recurrence} gives a formula to compute all the
%% coefficients of $Q_{i,j}$ using $O(\ell^{j-i})$ operations in $\F_p$. By
%% performing the same computation in the ring of $p$-adic integers with
%% just one digit of floating precision, it is possible to compute
%% $Q_{i,j}\bmod p$ using $O(\ell)$ operations in $\F_p$.

%% One remarkable property of the Lucas triangle is that the
%% anti-diagonals sum up to the Lucas numbers:
%% \begin{equation}
%%   \sum_{k\ge0} b_{n-k,k} = \sum_{k\ge0} \lvert c_{n,2k}\rvert = L_n.
%% \end{equation}
%% A funny consequence of this property is the following equality on
%% complex numbers
%% \begin{equation}
%%   \label{eq:lucas-fun}
%%   p_\ell(i) = \sum_{k\ge0} c_{\ell,k}i^{\ell-k} = i^\ell L_\ell.
%% \end{equation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{The general case}

Finally, we discuss the general situation, where we do not make any
assumption on the behavior of $\Phi_\ell$ in $\F_q[X]$. The results
below complete the third row of Table~\ref{table:main}, using the
bound $r=O(\ell)$. Since we are not able to exploit the more specific
Lenstra-De Smit construction in this case, we use Shoup's approach,
picking a non $\ell$-adic residue at random.

Because $r=[\K_0 : \F_q]$ divides $\ell-1$, it is coprime with
$\ell$. Thus, $Q_i$ remains the minimal polynomial of $x_i$ over
$\K_0$, and more generally $Q_{i,j}$ remains the minimal polynomial of
$x_i$ over $\K_{j}$; this will allow us to replace $\F_q$ by $\K_0$ as
our base field. We will measure all costs by counting operations in
$\K_0$, and we will deduce the cost over $\F_q$ by adding a factor
$O(\Mult(r)\log(r))$ to account for the cost of arithmetic in $\K_0$.

For $i \ge 0$, since $\K_i=\K_0[Y_i]/\langle Y_i^{\ell^i}-y_0\rangle$,
we represent the elements of $\K_i$ on the basis $\{y_i^e \mid 0 \le e
< \ell^i\}$; for instance, $x_i$ is written on this basis as
\begin{equation}\label{eq-def:xiyi}
x_i = \sum_{j = 0}^{r-1} y_i^{q^{\ell^i j} \bmod \ell^i}
y_0^{q^{\ell^i j} {\rm~div~} \ell^i}. 
\end{equation}
%% Operations $\{+,-,\times,\div\}$ in $\K_i$ take
%% $O(\Mult(\ell^i)\log(\ell^i))$ operations in $\K_0$.
Our strategy is to show how to convert between two univariate bases of
$\K_i$, $\{y_i^e \mid 0 \le e < \ell^i\}$ and $\{x_i^e \mid 0 \le e <
\ell^i\}$. In other words, we show how to apply the isomorphism
$$\Psi_i: \K_i=\K_0[Y_i]/\langle Y_i^{\ell^i}-y_0\rangle \to
\K_0[X_i]/\langle Q_{i,0}\rangle$$ and its inverse; we will compute
the required polynomials $Q_{i,0}$ and $Q_{i,i-1}$ as a byproduct. In
a second time, we will use $\Psi_i$ to perform push and lift between
the monomial basis in $x_i$ and the bivariate basis in
$(x_{i-1},x_i)$.

We proceed step-by-step, factoring $\Psi_i$ into elementary
isomorphisms
$$\Psi_{i,j}: \K_j[X_i]/\langle Q_{i,j}\rangle \to
\K_{j-1}[X_i]/\langle Q_{i,j-1}\rangle,$$ for $j=i,\dots,1$.  To start
the process, with $j=i$, we let $Q_{i,i}=X_i-x_i \in \K_i[X_i]$,
so that $\K_i=\K_i[X_i]/\langle Q_{i,i} \rangle$.

Let $j \le i$ and suppose that $Q_{i,j}$ is known. We are going to
factor $\Psi_{i,j}$ further as $\Phi''_{i,j} \circ \Phi'_{i,j} \circ
\Phi_{i,j}$. First, we introduce the isomorphism
$$\varphi_j: \K_j \to \K_{j-1}[Y_j]/\langle Y_j^\ell-y_{j-1}\rangle.$$
The forward direction is a push from the monomial basis in $y_j$ to
the bivariate basis in $(y_{j-1},y_j)$ and the inverse is a lift; none
of them involves any arithmetic operation (see
Subsection~\ref{ssec:T1}).  Then, we deduce the isomorphism
$$\Phi_{i,j}: \K_j[X_i]/\langle Q_{i,j} \rangle \to
\K_{j-1}[Y_j,X_i]/\langle Y_j^\ell-y_{j-1}, Q^\star_{i,j}\rangle,$$
where $Q^\star_{i,j}$ is obtained by applying $\varphi_j$ to all
coefficients of $Q_{i,j}$. Since $\Phi_{i,j}$ consists in a
coefficient-wise application of $\varphi_j$, applying it or its
inverse costs no arithmetic operations.

Next, changing the order of the variables $Y_j$ and $X_i$, we deduce
that there exists $S_{i,j}$ in $\K_{j-1}[X_j]$ such that we have an
isomorphism
\begin{multline*}
\Phi'_{i,j}: \K_{j-1}[Y_j,X_i]/\langle Y_j^\ell-y_{j-1}, Q^\star_{i,j}\rangle
\to\\ \K_{j-1}[X_i, Y_j]/\langle Q_{i,j-1}, Y_j-S_{i,j}\rangle;
\end{multline*}
where $\deg(Q^\star_{i,j},X_i)=\ell^{i-j}$ and
$\deg(Q_{i,j-1},X_i)=\ell^{i-j+1}$. This conversion is less obvious
than the previous one.
\begin{lemma}
  Given $Q^\star_{i,j}$, one can compute $Q_{i,j-1}$ and $S_{i,j}$
  using $O(i\Mult(\ell^{i+1})\log(\ell))$ operations in $\K_0$.
  Once this is done, we can apply $\Phi'_{i,j}$ and its inverse 
  using $O(\Mult(\ell^{i+1}))$ operations in $\K_0$.
\end{lemma}
\begin{proof}
  We obtain $Q_{i,j-1}$ and $S_{i,j}$ from the resultant and degree-1
  subresultant of $Y_j-y_{j-1}$ and $Q^\star_{i,j}$ with respect to
  $Y_j$, computed over the polynomial ring $\K_{j-1}[X_i]$. This is
  done by the algorithms of~\cite{Reischert97,LiRo01}, using
  $O(\Mult(\ell^{i+1})\log(\ell))$ operations in $\K_0$. To obtain
  $S_{i,j}$, we invert the leading coefficient of the degree-1
  subresultant modulo the resultant $Q_{i,j-1}$; this takes
  $O(\Mult(\ell^{i})\log(\ell^i))$ operations in $\K_0$.

  Applying $\Phi'_{i,j}$ amounts to taking a polynomial $A(Y_j,X_i)$ 
  reduced modulo $\langle Y_j^\ell-y_{j-1}, Q^\star_{i,j}\rangle$
  and reducing it modulo $\langle Q_{i,j-1}, Y_j-S_{i,j}\rangle$. This
  is done by evaluating $Y_j$ at $S_{i,j}$, doing all operations
  modulo $Q_{i,j-1}$. Using Horner's scheme, this takes $O(\ell)$ 
  operations $(+,\times)$ in $\K_{j-1}[X_i]/\langle Q_{i,j-1}\rangle$,
  so the complexity claim follows.

  In the converse direction, we start from $A(X_i)$ reduced modulo
  $Q_{i,j-1}$; we have to reduce it modulo $\langle Y_j^\ell-y_{j-1},
  Q^\star_{i,j}\rangle$. This is done by applying the fast Euclidean
  division algorithm with coefficients in $\K_{j-1}[Y_j]/\langle
  Y_j^\ell-y_{j-1}\rangle$, for a cost of $O(\Mult(\ell^{i+1}))$
  operations in $\K_0$.
\end{proof}

The last isomorphism $\Phi''_{i,j}$ is trivial:
$$\Phi''_{i,j}: \K_{j-1}[X_i, Y_j]/\langle Q_{i,j-1}, Y_j-S_{i,j}\rangle
\to \K_{j-1}[X_i]/\langle Q_{i,j-1}\rangle$$
forgets the variable $Y_j$; it requires no arithmetic operation.

\medskip

Taking $j=i,\dots,1$ allows us to compute $Q_{i,i-1}$ and $Q_{i,0}$
for $O(i^2\Mult(\ell^{i+1})\log(\ell))$ operations in $\K_0$. Composing
the maps $\Psi_{i,j}$, we deduce further that we can apply $\Psi_i$ or
its inverse for $O(i\Mult(\ell^{i+1}))$ operations in $\K_0$.  

We claim that we can then perform push and lift between the monomial
basis in $x_i$ and the bivariate basis in $(x_{i-1},x_i)$ for the same
cost. Let us for instance explain how to lift.

We start from $A$ written on the bivariate basis in $(x_{i-1},x_i)$;
that is, $A$ is in $\K_0[X_{i-1},X_i]/\langle Q_{i-1},
T_{i}\rangle$. Apply $\Psi_{i-1}$ to its coefficients in
$x_i^0,\dots,x_i^{\ell-1}$, so as to rewrite $A$ as an element of
$$\K_0[Y_{i-1},X_i]/\langle Y_{i-1}^{\ell^{i-1}}-y_{i-2},
T_{i}\rangle = \K_{i-1}[X_i]/\langle Q_{i,i-1} \rangle.$$ Applying
$\Psi_{i,i}^{-1}$ gives us the image of $A$ in $\K_i$, and applying
$\Psi_i$ finally brings it to $\K_0[X_i]/\langle Q_{i}\rangle$.


%%%

\section{Towers from irreducible fibers}
\label{sec:fibers}

In this section we discuss another construction of the $\ell$-adic
tower based on work of Couveignes and
Lercier~\cite{couveignes+lercier11}. The results of this section are
summarized in the last two rows of Table~\ref{table:main}. This
construction is not unrelated to the ones of the previous section, and
indeed we will start by showing how those of Section~\ref{ssec:T1}
and~\ref{ssec:T2} reduce to it.

Here is the bottom line of Couveignes' and Lercier's idea. Let $G, G'$ be integral algebraic 
$\F_q$-groups, and let $\eta$ be the generic point of $G'$. We say a morphism $f: G \rightarrow 
G'$ is generically finite if the fiber $G_\eta = G \times_{G'} \kappa(\eta)$, where $\kappa(\eta)$ 
is the residue field of $G'$ at $\eta$, is a finite set. Now let $f: G \rightarrow G'$ be a 
surjective, generically finite morphism of finite type. Then the extension $K(G)/K(G')$ of the 
fraction fields is finite algebraic, and the degree of $f$ is defined as $[K(G): K(G')]$. The 
morphism $f$ is said to be separable if the extension $K(G)/K(G')$ is separable. If $f$ is 
separable of degree $\ell$ then the set of points $x \in G'$ with fiber $G_x$ of cardinality 
$\ell$ is a nonempty open subset $U \subset G'$. If the induced homomorphism $G(\F_q) \rightarrow 
G'(\F_q)$ of groups is not surjective then there are points of $G'(\F_q)$ with fibers living in an 
algebraic extension of $\F_q$. Assume that we are able to choose $f$ so that at least one of these 
points is contained in $U$ and has an irreducible fiber, then we project its fiber onto a linear 
form in generic position (e.g., onto an axis). The resulting polynomial is irreducible of degree 
$\ell$, as required. If we can repeat the construction with a new map $f':G''\to G'$, and so on 
indefinitely, the sequence of extensions makes an $\ell$-adic tower over $\F_q$.






\subsection{Towers from algebraic tori}

In~\cite{couveignes+lercier11}, Couveignes and Lercier explain how
their idea yields the tower of Section~\ref{ssec:T1}. Consider the
multiplicative group $\mathbb{G}_m/\F_q$, it is an algebraic group of
dimension one and cardinality $q-1$.  The $\ell$-th power map defined
by $\phi:X\mapsto X^\ell$ is a degree $\ell$ algebraic endomorphism of
$\mathbb{G}_m$, surjective over the algebraic closure.

Suppose that $\ell$ divides $q-1$, and let $\eta$ be a non $\ell$-adic
residue in $\F_q$. For any $i>0$, the fibers $\phi^{-i}(\eta)$ consist
of $\ell^i$ elements of $\bar{\F}_q$, and the function
$X^{\ell^i}-\eta$ vanishes on them. We have already discussed in
Section~\ref{sec:LDtower} how to compute in the $\ell$-adic tower
defined by the polynomials $X_i^{\ell^i}-\eta$.

More generally, let $\F_{q^n}/\F_q$ be a finite extension, we define
its \emph{maximal torus} as
\begin{equation}
  \label{eq:Tn}
  T_n = \{\alpha\in\F_{q^n} \;|\; \Norm_{\F_{q^n}/\F_{q^m}}(\alpha) = 1 
  \text{ for any $m|n$} \}.
\end{equation}
This is a multiplicative subgroup of $\F_q^\ast$, and, by Weil
descent, an algebraic group over $\F_q$. It has dimension $\euler(n)$,
cardinality $\Phi_n(q)$, and is isomorphic to
$\mathbb{G}_m^{\euler(n)}$ over the algebraic
closure~\cite{rubin-silverberg+crypto03,rubin+silverberg03,voskresenskii98}.

The construction of Section~\ref{ssec:T2} is obtained by considering
the torus $T_2$.

\begin{lemma}
  Let $x_i$ and $y_i$ be defined as in Section~\ref{ssec:T2}. The
  maximal torus $T_2$ of $\F_q(y_i)/\F_q(x_i)$ is isomorphic to the
  \emph{Pell conic}
  \begin{equation}
    \label{eq:Pell}
    C \;:\; 
    \begin{cases}
      \alpha^2 - \Delta\beta^2 = 4 &\text{if $p\ne2$,}\\
      \alpha^2\Delta + \alpha\beta + \beta^2 = 1 &\text{if $p=2$,}
    \end{cases}
  \end{equation}
  where
  \begin{equation}
    \Delta =
    \begin{cases}
      4x_i^2-16 & \text{if $p\ne 2$,}\\
      1/x_i^2   & \text{if $p=2$.}
    \end{cases}
  \end{equation}
  Multiplication in $T_2$ induces a group law on $C$. The neutral
  element is $(2,0)$ if $p\ne2$ or $(0,1)$ if $p=2$. The sum of two
  points $P=(\alpha,\beta)$ and $Q=(\alpha',\beta')$ is defined
  by
  \begin{equation}
    \label{eq:Pell-add}
    P\oplus Q =
    \begin{cases}
      \left(\frac{\alpha\alpha' + 4z_i^2\beta\beta'}{2},\; \frac{\alpha\beta' + \alpha'\beta}{2}\right) &
      \text{if $p\ne2$,}\\
      \left(\alpha\alpha' + \alpha\beta' + \alpha'\beta,\; \alpha\alpha'\Delta + \beta\beta'\right) &
      \text{if $p=2$.}
    \end{cases}
  \end{equation}
\end{lemma}
\begin{proof}
  Let $B$ be the vector space basis of $F_q(y_i)$ over $\F_q(x_i)$
  defined as follows:
  \begin{equation*}
    B = (b_0, b_1) =
    \begin{cases}
      (1/2, y_i - y_i^{-1}) = (1/2, \sqrt{\Delta}/2) & \text{if $p\ne2$,}\\
      (y_i/x_i, 1) & \text{if $p=2$.}
    \end{cases}
  \end{equation*}
  
  By virtue of Eq.~\eqref{eq:Tn}, an element $\alpha b_0 + \beta b_1$
  belongs to $T_2$ if and only if $\Norm(\alpha b_0+\beta b_1)=1$,
  which is equivalent to Eq.~\eqref{eq:Pell}.  The group law is
  obtained by direct calculation.
\end{proof}

Pell conics are a widely studied topic. They have applications in
primality proving and
factorization~\cite{lemmermeyer03,hambleton12}. As customary, we
denote by $[n](\alpha,\beta)$ the $n$-th scalar multiple of a point
$(\alpha,\beta)$.

\begin{proposition}
  \label{th:T2-divpol}
  Suppose $(n,p)=1$, then $[n]$ is a separable endomorphism of $C$ of
  degree $n$, given by the rational maps
  \begin{equation}
    \label{eq:Pell-rec}
    [n](\alpha,\beta) = 
    \begin{cases}
      \bigr(P_n(\alpha), \beta R_n(\alpha)\bigl) & \text{if $p\ne2$,}\\
      \bigr(P_n(\alpha), \beta R_n(\alpha) + R_{n-1}(\alpha)\bigl) & \text{if $p=2$.}      
    \end{cases}
  \end{equation}
  where $P_n$ is defined as in Eq.~\eqref{eq:simple}, and $R_n$ is
  defined by
  \begin{equation}
    \label{eq:fibonacci}
    \begin{aligned}
      R_0 &= 0,\\
      R_1 &= 1,\\
      R_{n+1} &= XR_{n} - R_{n-1} = P_n + R_{n-1}.
    \end{aligned}
  \end{equation}
\end{proposition}
\begin{proof}
  We know that $C\isom\mathbb{G}_m$, thus $C[n]\isom\Z/n\Z$ and $[n]$
  is separable of degree $n$. Eq.~\eqref{eq:Pell-rec} is shown by
  induction using Eq.~\eqref{eq:Pell-add}.
\end{proof}

\begin{theorem}
  \label{th:T2-irred}
  Let $P=(\alpha,\beta)$ be a point on $C/\F_q$ of order
  divisible by $\ell^\kappa$, where $\kappa$ is the $\ell$-adic
  valuation of $q+1$.  For any $i>0$, the polynomials
  $P_{\ell^i}-\alpha$ are irreducible.
\end{theorem}
\begin{proof}
  Let $Q$ be a point such that $[\ell^i]Q=P$. By definition, $Q$ has
  order divisible by $\ell^{i+\kappa}$, hence,
  by~\cite[Th.~VI.9.1]{lang}, it is defined in
  $\F_{q^{\ell^i}}$. Hence, by Prop.~\ref{th:T2-divpol}, the fiber
  $[\ell^i]^{-1}(P)$ is irreducible over $\F_q$ and contains $\ell^i$
  points.

  We project this fiber onto the $\alpha$-coordinate. By
  Eq.~\eqref{eq:Pell-add}, two points of $C$ have the same
  $\alpha$-coordinate if and only if they are opposite. But
  $\kappa\ge1$, thus $P\ne-P$, hence all the points in
  $[\ell^i]^{-1}(P)$ have distinct $\alpha$-coordinates. We deduce
  that $P_{\ell^i}-\alpha$ is separable and, thus, irreducible.
\end{proof}

Observe that the theorem above implies Corollary~\ref{th:T2-resultant}
by choosing $y_0$ as starting point $P$. So, this construction yields
the same tower as in Sec.~\ref{ssec:T2}, except for the initialization
point.

\begin{lemma}
  \label{th:montgomery}
  Let $P=(\alpha,\beta)$ be a point on $C$. For any $n$, the
  $\alpha$-coordinate of $[\pm n]P$ can be computed without knowledge of
  $\beta$ using $O(\log n)$ operations in $\F_q$.
\end{lemma}
\begin{proof}
  Observe that if $n=2$, the $\alpha$-coordinate of $[\pm 2]P$ is
  $\alpha^2-2$ (for any $p$).  Let $P'=(\alpha,\beta)$, and let
  $\gamma$ be the $\alpha$-coordinate of $P\ominus P'$, by direct
  computation we find that the $\alpha$-coordinate of $P\oplus P'$ is
  $\alpha\alpha'-\gamma$ (for any $p$); this formula is called a
  \emph{differential addition}.

  In conclusion $O(1)$ operations are needed for a doubling or a
  differential addition. To compute the $\alpha$-coordinate of $[\pm
  n]P$, we use the ladder algorithm of~\cite{montgomery}, requiring
  $O(\log n)$ doublings and differential additions.
\end{proof}

\begin{proposition}
  The $\alpha$ coordinate of a point $P\in C/\F_q$ satisfying the
  conditions of Theorem~\ref{th:T2-irred} can be found using $O_e(\log
  q)$ operations in $\F_q$.
\end{proposition}
\begin{proof}
  We randomly select $\alpha\in\F_q$ and test that it belongs to
  $C$. If $p\ne2$, this amounts to testing that $\alpha^2-4$ is a
  quadratic non-residue in $\F_q$, a task that can be accomplished
  with $O(\log q)$ operations. If $p=2$, by Artin-Schreier theory,
  this is equivalent to $\Tr_{\F_q/\F_2}(\Delta+1/\alpha^2)=0$; with a
  naive algorithm, the trace can be computed using $O(\log q)$
  operations in $\F_q$.

  Then we check that the order of $P$ is divisible by $\ell^\kappa$ by
  verifying that $[(q+1)/\ell]P$ is not the group identity. By
  Lemma~\ref{th:montgomery}, this computation requires $O(\log q)$
  operations.

  About half of the points of $\F_q$ are quadratic non-residues, and
  about $1-1/\ell$ of them are the abscissas of points with the
  required order, thus we expect to find $\alpha$ after $O_e(1)$ trials.
\end{proof}

It is natural to ask whether a similar construction could be applied
to any $\ell$. If $r$ is the order of $q$ modulo $\ell$, the natural
object to look at is $T_r$, but here we are faced with two
problems. First, multiplication by $\ell$ is now a degree
$\ell^{\euler(r)}$ map, thus its fibers have too many points and are
not going to be irreducible in general. Second, it is an open question
whether $T_r$ can be parameterized using $\euler(r)$ coordinates; but
even assuming it can be, we are still faced with the problem of
projecting a set embedded in a $\euler(r)$-dimensional space onto a
linear form, a task not known to be computable in quasi-linear
time. Studying this problem is another natural follow-up to the
present work.


\subsection{Towers from elliptic curves}

Since it seems hard to deal with higher dimensional algebraic tori, it
is interesting to look at other algebraic groups. Being
one-dimensional, elliptic curves are good candidates. We quickly
review Couveignes' and Lercier's construction and refer
to~\cite{couveignes+lercier11} for details.

\begin{figure}
  \centering
  \begin{tikzpicture}
    \def\n{4}
    \foreach \i in {0,...,\n} {
      \pgfmathparse{360/(\n+1)*(\i-1/2) - 90}
      \let\angle\pgfmathresult
      \draw (\angle:1) node (E\i) {$E_\i$};
      % \draw (\angle:0.4) node {\scriptsize$H_\i$};
      % \draw (\angle:0.7) node[rotate=\angle] {\scriptsize$\subset$};
    }
    \foreach \i in {0,...,\n} {
      \pgfmathparse{int(mod(\i+1, \n+1))}
      \let\j\pgfmathresult
      \draw (E\i) edge[->,bend right=18] node[auto,swap] {\scriptsize$\phi_\i$} (E\j);
    }
  \end{tikzpicture}
  \caption{An $\ell$-isogeny volcano with the Vélu isogenies
    represented.}
  \label{fig:volcano}
\end{figure}

Let $\ell$ be a prime different from $p$ and not dividing $q-1$. Let
$E_0$ be an elliptic curve whose cardinality is a multiple of
$\ell$. By Hasse's bound, this is only possible if $\ell\le q +
2\sqrt{q} + 1$. An \emph{isogeny} is an algebraic group morphism
between two elliptic curves that is surjective in the algebraic
closure; it is said to be rational over $\F_q$ if it is invariant
under the $q$-th power map. A rational isogeny between two curves
exists if and only if they have the same number of points over
$\F_q$. The degree of an isogeny is its degree as an algebraic map; an
isogeny of degree $n$ is separable if and only if $n$ is prime to $p$,
in which case its kernel contains exactly $n$ points. A connected
component of the graph whose vertices are elliptic curves up to
isomorphism and whose edges are rational isogenies of degree $\ell$ is
called an \emph{$\ell$-isogeny
  volcano}~\cite{kohel,fouquet+morain02}. It is an undirected graph
and, in the specific case at hand, it is a cycle.
Figure~\ref{fig:volcano} shows one such example with one direction
highlighted. From now on, we denote by $E_0,E_1,\dots$ the curves in
the same volcano as $E_0$.

We now make precise the order in which the curves $E_i$ are
labeled. Suppose that $p\ne2,3$ and let $E_0$ be expressed as the
locus
\begin{equation}
  E_0 \;:\; y^2 = x^3 + ax + b,
  \quad\text{with $a,b\in\F_q$},
\end{equation}
plus one point at infinity. Under the former assumptions on $\ell$,
there exists $e\ge1$ such that the $\ell$-Sylow subgroups of
$E_i/\F_q$ are isomorphic to $\Z/\ell^e\Z$ for any $i$. We denote by
$H_0$ the unique subgroup of $E_0/\F_q$ of order $\ell$, and by
$\phi_0$ the unique isogeny whose kernel is $H_0$; we then label $E_1$
the image curve of $\phi_0$. We go on denoting by $H_i$ the unique
subgroup of $E_i/\F_q$ of order $\ell$, and by $\phi_i:E_i\to E_{i+1}$
the unique isogeny with kernel $H_i$, until we get back to the
starting point.

Vélu's formulas~\cite{velu71} allow us to express the isogenies
$\phi_i$ as rational fractions
\begin{equation}
  \begin{aligned}
    \phi_i: E_i &\to E_{i+1},\\
    (x,y) &\mapsto \left(\frac{f_i(x)}{g_i(x)}, y\left(\frac{f_i(x)}{g_i(x)}\right)'\right),
  \end{aligned}
\end{equation}
where $g_i$ is the square polynomial of degree $\ell-1$ vanishing on
the abscissas of the affine points of $H_i$, and $f_i$ is a polynomial
of degree $\ell$. Algorithmically, Vélu isogenies can be computed
using $O(\Mult(\ell))$ operations in $\F_q$. 

In what follows, the index $i$ in $\phi_i$, $f_i$, $g_i$ and $E_i$ is
to be understood modulo the length of the cycle. This is a slight
abuse, because of some subtleties linked to Vélu's formulas and the
way we consider curves up to isomorphism, but it does not hide any
theoretical or computational difficulty.  For an arbitrary $i$, let
$P$ be a point on $E_{i+1}$ of order divisible by $\ell^e$, Couveignes
and Lercier show that its fiber by $\phi_i$ is irreducible of
cardinality $\ell$. If the order of $P$ is not $2$, all the abscissas
of its fiber are distinct; hence, if $\eta$ is the abscissa of $P$,
the polynomial
\begin{equation}
  \label{eq:isog-fiber}
  f_i(X) - g_i(X)\eta
\end{equation}
is irreducible of degree $\ell$. They also show that, under the same
assumption on $\eta$, the system of equations
\begin{equation}
  \label{eq:elliptic}
  \left|
  \begin{aligned}
    \textstyle
    \frac{f_{i-j}}{g_{i-j}}(X_{j+1}) = X_j\quad\\
    \vdots\qquad\\
    \textstyle
    \frac{f_{i-1}}{g_{i-1}}(X_2) &= X_1\\
              &\textstyle\frac{f_i}{g_i}(X_1) &= \eta
  \end{aligned}
  \right.
\end{equation}
defines an $\ell$-adic closure of $\F_q$. By composing the relations,
we have that
\begin{equation}
  \label{eq:elliptic-uni}
  \frac{f_i}{g_i}\left(\frac{f_{i-1}}{g_{i-1}}\left(\cdots\frac{f_{i-j}}{g_{i-j}}(X)\right)\right) = \eta
\end{equation}
defines an extension of $\F_q$ of degree $\ell^{j+1}$. In the next
section we show how to compute this relation efficiently.

\begin{corollary}
  \sloppy
  Let $y$ be the generator of $\F_{p^{\ell^i}}$ over
  $\F_{p^{\ell^{i-1}}}$. Its minimal polynomial over $\F_p$ can be
  computed using $O(\Mult(\ell^i)\log\ell^i)$ operations in $k$.
\end{corollary}
\begin{proof}
  The composition can be computed using
  Algorithm~\ref{alg:compose}. The complexity bound is proved in
  Theorem~\ref{th:compose}.
\end{proof}

\begin{remark}
  \label{rk:cycle}
  There is a major difference between our setting and Couveignes' and
  Lercier's. Observe that, once a point $P$ of $E_i$ is chosen, the
  $\ell$-adic tower is constructed by walking \emph{backwards} in the
  isogeny cycle. The goal of~\cite{couveignes+lercier11}, is to
  compute an extension of degree $\ell^i$ of $\F_q$ for a certain
  fixed $i$. Under the former assumptions, using the construction we
  just presented, this can be done in quasi-linear time in $\ell^i$:
  apply $i$ times Vélu's formulas, then take the fiber of a point of
  $E_i$ by the isogenies $\phi_{i-1}, \ldots, \phi_0$. In our case, we
  are interested in building extensions of degree $\ell^i$
  \emph{incrementally}, i.e.\ without any \emph{a priori} bound on
  $i$. We have two ways of doing this:
  \begin{enumerate}
  \item Precompute the whole cycle, this can be done using Vélu's
    formulas only. Assuming the cycle has length $n$, chose a point of
    $E_0$ and take its fiber by the isogenies $\phi_{n-1}, \ldots,
    \phi_0, \phi_{n-1}, \ldots$ The length of the isogeny cycle is the
    order of a certain ideal in the class group of the endomorphism
    ring of $E_0$, thus it is proportional to $\sqrt{q}$. Hence, this
    approach has a quasi-linear complexity in $\ell^i$, but an
    exponential complexity in $\log q$.
  \item Compute the curves on the isogeny cycle backwards, then apply
    Vélu's formulas. This can be done incrementally, thus it does not
    require to precompute the whole isogeny cycle. However, computing
    $E_{i-1}$ from the knowledge of $E_i$ can only be done by
    factoring the $\ell$-th \emph{modular polynomial}~\cite{schoof95},
    a task requiring $O(\ell^3)$ bit operations and $O(\ell^2)$
    operations in $\F_q$~\cite{sutherland10:modpol}.
  \end{enumerate}
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Lifting and pushing}
\label{sec:lift-push}

The previous constructions of $\ell$-adic towers based on irreducible
fibers share a common structure that allows us to treat lifting and
pushing in a unified way. Renaming the variables $(X_{i-1},X_i)$ as
$(X,Y)$, the polynomials $(Q_{i-1},Q_i,T_i)$ as $(R,S,T)$, the
extension at level $i$ is described as
$$\F_q[Y]/ \langle S(Y) \rangle \quad\text{and}\quad \F_q[X,Y]/\langle
R(X), T(X,Y) \rangle,$$ with $R$ of degree $\ell^{i-1}$, $S$ of degree
$\ell^i$, and where $T(X,Y)$ has the form $f(Y)-X g(Y)$, with $\deg(f)
=\ell$, $\deg(g) < \ell$ and $\gcd(f,g)=1$; possibly, $g=1$. In all
this section, $f$, $g$ and their degree $\ell$ are fixed.

%% According to Eqs.~\eqref{eq:T1}, \eqref{eq:T2-minpols}
%% and~\eqref{eq:elliptic}, the polynomials $Q_{i-1}$ are equivalent to
%% the relation
%% \begin{equation}
%%   \label{eq:level-i}
%%   \frac{F_{i-1}(x_{i-1})}{G_{i-1}(x_{i-1})} = \eta,
%% \end{equation}
%% where $F$ is a polynomial of degree $\ell^{i-1}$, $G$ is a polynomial
%% of degree less than $\ell^{i-1}$ (eventually, $G=1$), and $\eta$ is an
%% element of $\F_q$. Similarly, the polynomials $T_i$ are equivalent to
%% the relation
%% \begin{equation}
%%   \label{eq:level-i+1}
%%   \frac{f_i(x_i)}{g_i(x_i)} = x_{i-1},
%% \end{equation}
%% where $f$ is a polynomial of degree $\ell$, and $g$ is a polynomial of
%% degree less than $\ell$ (eventually, $g=1$).  

Lift is the conversion from the bivariate basis associated to the
right-hand side to the univariate basis associated to the left-hand side;
push is the inverse. Using the special shape of the polynomial $T$,
they reduce to composition and decomposition of rational functions, as
we show next. These results fill in all missing entries in the lift / push 
column of Table~\ref{table:main}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Lifting}

Let $P$ be in $\F_q[X,Y]$ and $n$ be in $\N$. with $\deg(P,X)< n$. We
define $P[f,g,n]$ as
$$P[f,g,n] = g^{n-1} P\left (\frac fg, Y\right) \in \F_q[X,Y].$$ If
$P=\sum_{i=0}^{n-1} p_i(Y) X^i$, then $P[f,g,n] = \sum_{i=0}^{n-1}
p_if^ig^{n-1-i}$.  We first give an algorithm to compute this
expression, then show how to relate it to lifting; when $g=1$,
Algorithm~\ref{alg:compose} reduces to a well known algorithm for
polynomial composition~\cite[Ex.~9.20]{vzGG}.

\begin{algorithm}[t]
  \caption{Compose}
  \label{alg:compose}
  \begin{algorithmic}[1]
    \REQUIRE $P\in \F_q[X,Y]$, $f,g\in \F_q[Y]$, $n\in\N$
    \IF {$n = 1$} 
    \RETURN $P$
    \ELSE
    \STATE $m \la \lceil n/2\rceil$
    \STATE Let $P_0,P_1$ be such that $P = P_0 + X^mP_1$
    \STATE $Q_0 \la$ Compose($P_0, f, g, m$)
    \STATE $Q_1 \la$ Compose($P_1, f, g, n-m$)
    \STATE $Q \la Q_0g^{n-m} + Q_1f^m$  \label{alg:compose:res}
    \RETURN $Q$
    \ENDIF
  \end{algorithmic}
\end{algorithm}

\begin{theorem}
  \label{th:compose}
  On input $P,f,g,n$, with $\deg(P,X)<n$ and $\deg(P,Y) < \ell$,
  Algorithm~\ref{alg:compose} computes $Q=P[f,g,n]$ using $O(\Mult(\ell
  n)\log(n))$ operations in $\F_q$.
\end{theorem}
\begin{proof}
  If $n=1$, the theorem is obvious. Suppose $n>1$, then $P_0$ and
  $P_1$ have degrees less than respectively $m$ and $n-m$
  respectively. By induction hypothesis,
  \begin{equation*}
    \begin{aligned}
      Q_0 &= P_0[f,g,m] = \sum_{i=0}^{m-1}p_if^ig^{m-1-i},\\
      Q_1 &= P_1[f,g,n-m] = \sum_{i=0}^{n-m-1}p_{i+m}f^ig^{n-m-1-i}.   
    \end{aligned}
  \end{equation*}
  Hence,
  \begin{equation*}
    Q = \sum_{i=0}^{m-1}p_if^ig^{n-1-i} +
    \sum_{i=0}^{n-m-1}p_{i+m}f^{i+m}g^{n-m-1-i} =
    P[f,g,n].
  \end{equation*}
  The only step that requires a computation is
  Step~\ref{alg:compose:res}, costing $O(\Mult(\ell n))$ operations in
  $\F_q$. The recursion has depth $\log(n)$, hence the overall
  complexity is $O(\Mult(\ell n)\log(n))$.
\end{proof}

\begin{corollary}
  At level $i$, one can perform the lift operation using
  $O(\Mult(\ell^i)\log(\ell^i))$ operations in $\F_q$.
\end{corollary}
\begin{proof}
  We start from element $\alpha$ written on the bivariate basis, that
  is, represented as $A(X,Y)$ with $\deg(A,X)<n=\ell^{i-1}$ and
  $\deg(A,Y)<\ell$ (note that $\ell n =\ell^i$).  We compute the
  univariate polynomials $A^\star=A[f,g,n]$ and $\gamma=g^{n-1}$ using
  $O(\Mult(\ell^i)\log(\ell^i))$ operations in $\F_q$; then the lift
  of $\alpha$ is $A^\star/\gamma$ modulo $S$. The inverse of $\gamma$
  is computed using $O(\Mult(\ell n)\log(\ell n))$ operations, and the
  multiplication adds an extra $O(\Mult(\ell n))$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Pushing}

We first deal with the inverse of the question dealt with in
Theorem~\ref{th:compose}: starting from $Q \in \F_q[Y]$, reconstruct
$P \in \F_q[X,Y]$ such that $Q=P[f,g,n]$. When $g=1$,
Algorithm~\ref{alg:decompose} reduces to Algorithm~9.14
of~\cite{vzGG}.

\begin{algorithm}[t]
  \caption{Decompose}
  \label{alg:decompose}
  \begin{algorithmic}[1]
    \REQUIRE $Q,f,g,h\in \F_q[Y]$, $n \in \N$ 
    \IF {$n=1$} 
    \RETURN $Q$
    \ELSE 
    \STATE $m \la \lceil n/2 \rceil$ 
    \STATE $u \la 1/ g^{n-m}\bmod f^m$ \label{alg:decompose:xgcd} 
    \STATE $Q_0 \la Q u \bmod f^m$ 
    \STATE $Q_1 \la (Q-Q_0 g^{n-m}) {\rm~div~} f^m$ 
    \STATE $P_0 \la$ Decompose($Q_0, f, g, h, m$) 
    \STATE $P_1 \la$ Decompose($Q_1, f, g, h, n-m$) 
    \RETURN $P_0 + X^m P_1$ 
    \ENDIF
  \end{algorithmic}
\end{algorithm}

\begin{theorem}
  On input $Q,f,g,h,n$, with $\deg(Q) < \ell n$ and $h = 1/g \bmod f$,
  Algorithm~\ref{alg:decompose} computes a polynomial $P\in \F_q[X,Y]$
  such that $\deg(P,X)<n$, $\deg(P,Y) <\ell$ and $Q=P[f,g,n]$ using
  $O(\Mult(\ell n)\log(n))$ operations in $\F_q$.
\end{theorem}
\begin{proof}
  We prove the theorem by induction. If $n=1$, the statement is
  obvious, so let $n> 1$. The polynomials $Q_0$ and $Q_1$ verify $Q =
  Q_0g^{n-m} + Q_1f^m.$ By construction, $Q_0$ has degree less than $\ell
  m$. Since $\deg(g) < \ell$, this implies that $Q_0 g^{n-m}$ has
  degree less than $\ell n$; thus, $Q_1$ has degree less than $\ell
  (n-m)$. By induction, $P_0$ and $P_1$ have degree less than $m$,
  resp. $n-m$ in $X$, and less than  $\ell$ in $Y$, and
  \begin{equation*}
    \begin{aligned}
      Q_0 &= P_0[f,g,m] = \sum_{i=0}^{m-1} p_{0,i}f^ig^{m-1-i},\\
      Q_1 &= P_1[f,g,n-m] = \sum_{i=0}^{n-m-1} p_{1,i}f^ig^{n-m-1-i}.
    \end{aligned}
  \end{equation*}
  Hence, $P=P_0+X^mP_1$ has degree less than $n$ in $X$ and less than $\ell$ 
  in $Y$, and the following proves correctness:
  \begin{multline*}
    P[f,g,n] = \sum_{i=0}^{m-1}p_{0,i}f^ig^{n-1-i} + 
    \sum_{i=m}^{n-1}p_{1,i-m}f^ig^{n-1-i} \\
    =P_0[f,g,m]g^{n-m} + P_1[f,g,n-m]f^m = Q.
  \end{multline*}
  At Step~\ref{alg:decompose:xgcd}, we do as follows: starting from
  $h=1/g \bmod f$, we deduce $1/g^{n-m} \bmod f$ in time
  $O(\Mult(\ell)\log(n))$ by binary powering mod $f$. We also compute
  $g^{n-m}$ in time $O(\Mult(\ell n))$ by binary powering, and we use
  Newton iteration (starting from $1/g^{n-m} \bmod f$) to deduce
  $1/g^{n-m} \bmod f^m$ in time $O(\Mult(\ell n))$. All other steps
  cost $O(\Mult(\ell n))$; the recursion has depth $\log(n)$,
  so the total cost is $O(\Mult(\ell n)\log(n))$.
\end{proof}

\begin{corollary}
  At level $i$, one can perform the push operation using
  $O(\Mult(\ell^i)\log(\ell^i))$ operations in $\F_q$.
\end{corollary}
\begin{proof}
  Given $\alpha$ represented by a univariate polynomial $A(Y)$ of
  degree less than $\ell n$, with $n =\ell^{i-1}$. We compute
  $g^{n-1}$ and $\bar{A} = g^{n-1} A \bmod S$ using $O(\Mult(\ell^i))$
  operations. Then, we compute $h=1/g \bmod f$ in time
  $O(\Mult(\ell)\log(\ell))$ and apply Algorithm~\ref{alg:decompose}
  to $\bar{A}$, $f$, $g$, $h$ and $n$. The result is a bivariate
  polynomial $B$, representing $\alpha$ on the bivariate basis. The
  dominant phase is Algorithm~\ref{alg:decompose}, costing
  $O(\Mult(\ell^i)\log(\ell^i))$ operations in $\F_q$.
\end{proof}

%%%

\section{Implementation}
\label{sec:impl}

Sage implementation and timings.

%%%

\section{Aknowledgements}
De Feo would like to thank Antoine Joux.

\scriptsize
\bibliographystyle{abbrv}
\bibliography{defeo}
\end{document}


% Local Variables:
% mode:flyspell
% ispell-local-dictionary:"american"
% mode:TeX-PDF
% mode:reftex
% End:
%
% LocalWords:  Isogeny abelian isogenies hyperelliptic supersingular Frobenius
% LocalWords:  isogenous embeddings Vélu




